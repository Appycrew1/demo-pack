import { NextRequest, NextResponse } from "next/server";import { fetchBrandFromUrl } from "@/lib/brand";import { downloadToBuffer, dominantHexFromImage } from "@/lib/brand_color";export const runtime="nodejs";export async function POST(req:NextRequest){try{const {url}=await req.json();if(!url)return NextResponse.json({error:"url required"},{status:400});const {orderedIconUrls}=await fetchBrandFromUrl(url);let logoBuf:Buffer|null=null;for(const u of orderedIconUrls){logoBuf=await downloadToBuffer(u);if(logoBuf&&logoBuf.length>200)break;}if(!logoBuf){return NextResponse.json({error:"Logo not found"},{status:404});}const primary=await dominantHexFromImage(logoBuf);const logoDataUrl=`data:image/*;base64,${logoBuf.toString("base64")}`;return NextResponse.json({primaryColor:primary,logoDataUrl});}catch(e:any){return NextResponse.json({error:e?.message||"Failed"},{status:500});}}
